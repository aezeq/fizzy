<% @page_title = "Subscription" %>

<% content_for :header do %>
  <h1 class="header__title"><%= @page_title %></h1>
<% end %>

<% if @session&.payment_status == "paid" %>
  <section class="panel shadow center margin-block-end">
    <h2>Thanks for subscribing!</h2>
    <p>Your payment was successful. You're now on the <strong><%= @account.plan.name %></strong> plan.</p>
  </section>
<% end %>

<section class="panel shadow center">
  <h2>Current Plan</h2>
  <p><strong><%= @account.plan.name %></strong></p>

  <% if @account.subscription %>
    <dl>
      <dt>Status</dt>
      <dd><%= @account.subscription.status&.titleize || "N/A" %></dd>

      <% if @account.subscription.current_period_end %>
        <dt>Current period ends</dt>
        <dd><%= @account.subscription.current_period_end.strftime("%B %d, %Y") %></dd>
      <% end %>
    </dl>
  <% end %>

  <div class="margin-block-start">
    <% if @account.plan.free? %>
      <%= button_to "Upgrade to Monthly", account_subscription_path(plan: :monthly_v1), class: "btn btn--primary", data: { turbo: false } %>
    <% else %>
      <%= link_to "Manage Billing", account_billing_portal_path, class: "btn", data: { turbo: false } %>
    <% end %>
  </div>
</section>
